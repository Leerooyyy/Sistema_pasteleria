{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ventas | Dulzuras de Belgi's</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body{
      background: linear-gradient(135deg, #fde7ef, #fff7ea);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:#3b2f2f;
    }
    .topbar{
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; color:#e04a74 !important; text-decoration:none;
    }
    .brand-logo{
      width:40px; height:40px; object-fit:contain; border-radius:50%;
      background:#fff; padding:4px;
      box-shadow:0 0 10px rgba(255,92,138,0.45);
    }
    .panel{
      border:0;
      border-radius:16px;
      background:#fff;
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
    }
    h3{ font-weight:800; }
    .form-label{ font-weight:700; color:#6b7280; }
    .form-control, .form-select{
      border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
    }
    .summary{
      background:#fff7fb;
      border:1px solid rgba(255,92,138,.20);
      border-radius:12px;
      padding:.9rem 1rem;
    }
    .summary .k{ color:#6b7280; font-weight:700; font-size:.92rem; }
    .summary .v{ font-weight:900; }
    .btn-pink{
      background: linear-gradient(135deg,#ff5c8a,#ff8fb3);
      border:0;
      color:#fff;
      font-weight:800;
      border-radius:12px;
      padding:.8rem 1rem;
      box-shadow: 0 10px 18px rgba(255,92,138,.22);
    }
    .btn-pink:hover{ filter: brightness(1.03); }
  </style>
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg topbar mb-4">
    <div class="container">
      <a class="navbar-brand brand" href="{% url 'ventas' %}">
        <img class="brand-logo" src="{% static 'ventas/img/logo_dulceria.png' %}" alt="Logo">
        <span>Dulzuras de Belgi's</span>
      </a>

      <div class="ms-auto d-flex gap-3">
        <a class="nav-link" href="{% url 'ventas' %}">Inicio</a>
        <a class="nav-link fw-bold" href="{% url 'ventas' %}">Ventas</a>
        <a class="nav-link" href="{% url 'lista_productos' %}">Productos</a>
        <a class="nav-link" href="{% url 'reporte_ventas' %}">Reportes</a>
        <a class="nav-link" href="{% url 'logout' %}">Cerrar Sesi√≥n</a>
      </div>
    </div>
  </nav>

  <main class="container pb-5">
    <div class="card panel">
      <div class="card-body p-4">
        <h3 class="mb-4">Nueva Venta</h3>

        <!-- FORM -->
        <form method="post" class="row g-3 align-items-start">
          {% csrf_token %}

          <!-- Izquierda -->
          <div class="col-12 col-lg-7">
            <div class="mb-3">
              <label class="form-label">Cliente:</label>
              <input type="text" name="cliente" class="form-control" value="Venta Mostrador">
            </div>

            <div class="mb-3">
              <label class="form-label">Producto:</label>
              <select name="producto" class="form-select" id="productoSelect">
                {% for p in productos %}
                  <option value="{{ p.id }}" data-precio="{{ p.precio }}">{{ p.nombre }}</option>
                {% empty %}
                  <option value="">No hay productos</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Cantidad:</label>
              <input type="number" min="1" value="1" name="cantidad" class="form-control" id="cantidadInput">
            </div>

            <div class="mb-3">
              <label class="form-label">Precio:</label>
              <input type="text" class="form-control" id="precioInput" readonly>
            </div>
          </div>

          <!-- Derecha -->
          <div class="col-12 col-lg-5">
            <div class="summary mb-3">
              <div class="d-flex justify-content-between">
                <span class="k">Precio Unitario:</span>
                <span class="v" id="precioUnitarioText">$0.00</span>
              </div>
              <hr class="my-2">
              <div class="d-flex justify-content-between">
                <span class="k">Subtotal:</span>
                <span class="v" id="subtotalText">$0.00</span>
              </div>
            </div>

            <button type="submit" class="btn btn-pink w-100">Registrar Venta</button>
          </div>
        </form>

      </div>
    </div>
  </main>

  <script>
    function money(n){
      const v = Number(n || 0);
      return '$' + v.toFixed(2);
    }

    const productoSelect = document.getElementById('productoSelect');
    const cantidadInput = document.getElementById('cantidadInput');
    const precioInput = document.getElementById('precioInput');
    const precioUnitarioText = document.getElementById('precioUnitarioText');
    const subtotalText = document.getElementById('subtotalText');

    function recalcular(){
      if (!productoSelect || !productoSelect.options.length) return;

      const opt = productoSelect.options[productoSelect.selectedIndex];
      const precioUnit = Number(opt.dataset.precio || 0);
      const qty = Number(cantidadInput.value || 0);
      const subtotal = precioUnit * qty;

      precioInput.value = money(subtotal);
      precioUnitarioText.textContent = money(precioUnit);
      subtotalText.textContent = money(subtotal);
    }

    if (productoSelect) productoSelect.addEventListener('change', recalcular);
    if (cantidadInput) cantidadInput.addEventListener('input', recalcular);
    window.addEventListener('load', recalcular);
  </script>

</body>
</html>
